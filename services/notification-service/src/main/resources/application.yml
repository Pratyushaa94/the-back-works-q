#
#  Copyright (c) 2025 Revinci AI.
#
#  All rights reserved. This software is proprietary to and embodies the
#  confidential technology of Revinci AI. Possession,
#  use, duplication, or dissemination of the software and media is
#  authorized only pursuant to a valid written license from Revinci AI.
#
#  Unauthorized use of this software is strictly prohibited.
#
#  THIS SOFTWARE IS PROVIDED BY Revinci AI "AS IS" AND ANY
#  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
#  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
#  DISCLAIMED. IN NO EVENT SHALL REVINCI AI BE LIABLE FOR
#  ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
#  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
#  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
#  CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
#  OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
#  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
# @author
#
#

logging:
  level:
    org.springframework.cloud.stream.binder: ${SPRING_LOG_LEVEL:ERROR}
    org.springframework.integration: ${SPRING_LOG_LEVEL:ERROR}
    com.azure.messaging.servicebus: ${SPRING_LOG_LEVEL:ERROR}
    org.springframework: ${SPRING_LOG_LEVEL:ERROR}
    ai.revinci: ${RVC_PLATFORM_LOG_LEVEL:DEBUG}
  pattern:
    level: "%5p [%X{realm:-},%X{tenantId:-},%X{applicationId:-}]"

# Health endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,metrics
  endpoint:
    health:
      probes:
        enabled: true
      show-details: always
  health:
    livenessState:
      enabled: true
    readinessState:
      enabled: true

# RVC Platform settings.
revinciai:
  platform:
    service:
      key: ns
    mail:
      sender:
        from: ${RVC_PLATFORM_MAIL_SENDER_FROM:support@revinci.ai}
    notification:
      settings:
        email:
          blacklisted-domains: ${RVC_PLATFORM_BLACKLISTED_EMAIL_DOMAINS:gmail.com,abc.com,outlook.com,hotmail.com,rediff.com,rediffmail.com}
          replace-email-domain: ${RVC_PLATFORM_REPLACE_EMAIL_DOMAIN:true}
          email-domain-replacement: ${RVC_PLATFORM_EMAIL_DOMAIN_REPLACEMENT:yopmail.com}
        tenant-provisioned:
          context: "NEW_TENANT_PROVISIONED"
          type: "EMAIL"
          subject: "Your hear@ai account has been provisioned and ready to use!"
          template-name: "tenant-onboarded.html"
        tenant-deactivated:
          context: "TENANT_DEACTIVATED"
          type: "EMAIL"
          subject: "Your hear@ai account has been deactivated. We are sorry to see you go!"
          template-name: "tenant-deactivated.html"
        self-appraisal-completed:
          context: "SELF_APPRAISAL_COMPLETED"
          type: "EMAIL"
          subject: "Performance Appraisal : ${fullName} has submitted their self-appraisal"
          template-name: "self-appraisal-completed.html"
        manager-review-completed:
          context: "MANAGER_REVIEW_COMPLETED"
          type: "EMAIL"
          subject: "Performance Appraisal : ${fullName} has submitted their self-appraisal"
          template-name: "manager-review-completed.html"
        appraisal-completed:
          context: "PERFORMANCE_APPRAISAL_COMPLETED"
          type: "EMAIL"
          subject: "Performance Appraisal of ${fullName} has completed"
          template-name: "performance-appraisal-completed.html"

# Server settings
server:
  port: 8083

# Application settings
spring:
  main:
    banner-mode: off
  application:
    name: notification-service
  # Redis settings
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      username: ${REDIS_USERNAME:default}
      password: ${REDIS_PASSWORD:redis}
  # Database settings
  datasource:
    driverClassName: org.postgresql.Driver
    username: ${MASTER_DB_USER:postgres}
    password: ${MASTER_DB_PASSWORD:postgres}
    url: jdbc:postgresql://${MASTER_DB_HOST:localhost}:${MASTER_DB_PORT:5432}/${MASTER_DB_NAME:local_master_rvc_platform_db}?createDatabaseIfNotExist=true
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      idle-timeout: 30000
      max-lifetime: 60000
      connection-timeout: 30000
  jpa:
    database: POSTGRESQL
    show-sql: ${MASTER_DB_SHOW_SQL:false}
    # Do NOT change generate-ddl to true. This will cause the db to be dropped and recreated.
    generate-ddl: false
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    properties:
      hibernate:
        default_batch_fetch_size: ${RVC_PLATFORM_DEFAULT_BATCH_FETCH_SIZE:30}
        # Leave the ddl-auto to none. Changing to any other value causes the db to be dropped and recreated.
        ddl-auto: none
        boot:
          allow_jdbc_metadata_access: true
        jdbc:
          batch_size: ${RVC_PLATFORM_DEFAULT_BATCH_FETCH_SIZE:30}
          lob:
            non_contextual_creation: true
  # Azure Service Bus JMS configuration
  jms:
    servicebus:
      connection-string: ${AZURE_SERVICEBUS_CONNECTION_STRING:Endpoint=sb://localhost;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=}
      pricing-tier: ${AZURE_SERVICEBUS_PRICING_TIER:premium}
  cloud:
    function:
      # Function bound to Spring Cloud Stream
      definition: rvcPlatformOnNotificationEvent;rvcPlatformOnDbProvisionedEvent;
    stream:
      bindings:
        # Binding to topic and subscription from where the notification details will be consumed from.
        rvcPlatformOnNotificationEvent-in-0:
          destination: ${spring.profiles.active}-rvc-platform-notification-topic
          group: ${spring.profiles.active}-rvc-platform-notification-topic-${revinciai.platform.service.key}-sub
          binder: servicebus
        # Binding to topic and subscription from where the database provisioning completion events are published.
        rvcPlatformOnDbProvisionedEvent-in-0:
          destination: ${spring.profiles.active}-rvc-platform-db-provisioned-topic
          binder: servicebus
  freemarker:
    template-loader-path: classpath:/templates
    charset: UTF-8
    cache: false
  mail:
    host: ${RVC_PLATFORM_SES_HOST}
    port: 465
    username: ${RVC_PLATFORM_SES_USERNAME}
    password: ${RVC_PLATFORM_SES_PASSWORD}
    properties:
      mail:
        debug: false
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
